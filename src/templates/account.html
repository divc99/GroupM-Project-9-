{% extends "layout.html" %}
{% block scan %}
<script src="https://asprise.azureedge.net/scannerjs/scanner.js" type="text/javascript"></script>

<script>
    function scanAndUploadDirectly() {
        scanner.scan(displayServerResponse,
            {
                "output_settings": [
                    {
                        "type": "upload",
                        "format": "pdf",
                        "upload_target": {
                            "url": "https://asprise.com/scan/applet/upload.php?action=dump",
                            "post_fields": {
                                "sample-field": "Test scan"
                            },
                            "cookies": document.cookie,
                            "headers": [
                                "Referer: " + window.location.href,
                                "User-Agent: " + navigator.userAgent
                            ]
                        }
                    }
                ]
            }
        );
    }
    function displayServerResponse(successful, mesg, response) {
        if (!successful) { // On error
            document.getElementById('server_response').innerHTML = 'Failed: ' + mesg;
            return;
        }
        if (successful && mesg != null && mesg.toLowerCase().indexOf('user cancel') >= 0) { // User cancelled.
            document.getElementById('server_response').innerHTML = 'User cancelled';
            return;
        }
        document.getElementById('server_response').innerHTML = scanner.getUploadResponse(response);
    }
    function check_empty() {
        if (document.getElementById('name').value == "" || document.getElementById('email').value == "" || document.getElementById('msg').value == "") {
            alert("Fill All Fields !");
        } else {
            document.getElementById('form').submit();
            alert("Form Submitted Successfully...");
        }
    }
    //Function To Display Popup
    function div_show() {
        document.getElementById('abc').style.display = "block";
    }
    //Function to Hide Popup
    function div_hide() {
        document.getElementById('abc').style.display = "none";
    }
</script>
<style>
    #abc {
        width: 100%;
        height: 100%;
        opacity: .95;
        top: 0;
        left: 0;
        display: none;
        position: fixed;
        background-color: #313131;
        overflow: auto
    }

    img#close {
        position: absolute;
        right: -14px;
        top: -14px;
        cursor: pointer
    }

    div#popupContact {
        position: absolute;
        left: 50%;
        top: 17%;
        margin-left: -202px;
        font-family: 'Raleway', sans-serif
    }

    form {
        max-width: 300px;
        min-width: 250px;
        padding: 10px 50px;
        border: 2px solid gray;
        border-radius: 10px;
        font-family: raleway;
        background-color: #fff
    }

    input[type=text] {
        width: 82%;
        padding: 10px;
        margin-top: 30px;
        border: 1px solid #ccc;
        padding-left: 40px;
        font-size: 16px;
        font-family: raleway
    }

    #name {
        background-image: url(../images/name.jpg);
        background-repeat: no-repeat;
        background-position: 5px 7px
    }

    #email {
        background-image: url(../images/email.png);
        background-repeat: no-repeat;
        background-position: 5px 7px
    }

    textarea {
        background-image: url(../images/msg.png);
        background-repeat: no-repeat;
        background-position: 5px 7px;
        width: 82%;
        height: 95px;
        padding: 10px;
        resize: none;
        margin-top: 30px;
        border: 1px solid #ccc;
        padding-left: 40px;
        font-size: 16px;
        font-family: raleway;
        margin-bottom: 30px
    }

    #submit {
        text-decoration: none;
        width: 100%;
        text-align: center;
        display: block;
        background-color: #FFBC00;
        color: #fff;
        border: 1px solid #FFCB00;
        padding: 10px 0;
        font-size: 20px;
        cursor: pointer;
        border-radius: 5px
    }
</style>
{% endblock scan %}


{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-8">
            <div class="content-section">
                <div class="media">
                    <img class="rounded-circle account-img" src="{{ url_for('static',filename='default.jpg') }}">
                    <div class="media-body">
                        <h2 class="account-heading"> {{current_user.username}} </h2>
                        <p class="text-secondary"> {{current_user.email}} </p>
                    </div>
                </div>
            </div>
            <div>
                <h2>Scanner.js: Scan and Upload Directly</h2>

                <button type="button" onclick="scanAndUploadDirectly();">Scan and Upload</button>

                <div id="server_response"></div>

            </div>
        </div>
        <div class="col-md-4">
            <div class="content-section">
                SHARE
            </div>
            <div class="content-section">
                {% for file in data %}
                <div>
                    {{file.id}}
                    <a href={{ url_for('download', file_id=file.id) }}>{{file.name}}</a>
                    <button style="background-color:#ffffff;padding: 0;border: none;background: none;" id="popup" onclick="div_show()">
                        <sup><img width=12
                                    class="rounded-circle account-img"
                                    src="{{ url_for('static',filename='share.png') }}">
                                <div id="abc">
                                    <!-- Popup Div Starts Here -->
                                    <div id="popupContact">
                                        <!-- Contact Us Form -->
                                        <form action="" id="form" method="post" name="form">
                                            <img id="close" src="#" onclick="div_hide()">
                                            <h2>Share</h2>
                                            <hr>
                                            <input id="name" name="name" placeholder="Name" type="text">
                                            <input id="email" name="email" placeholder="Email" type="text">
                                            <textarea id="msg" name="message" placeholder="Message"></textarea>
                                            <a href="javascript:%20check_empty()" id="submit">Send</a>
                                        </form>
                                    </div>
                                    <!-- Popup Div Ends Here -->
                                </div>
                            </sup></button>

                </div>
                {%endfor%}

            </div>
        </div>
    </div>

</div>
</div>

{% endblock content %}